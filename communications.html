 url=https://github.com/obviouslymelissa-hub/obsidianbastian/blob/main/communications.html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Obsidian Bastian — Communications</title>
  <style>
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:#071017;color:#e6eef3;margin:0;padding:18px}
    .panel{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);padding:12px;border-radius:8px;max-width:980px;margin:0 auto}
    h1{margin:0 0 12px 0}
    textarea{width:100%;height:220px;background:#071520;border:1px solid rgba(255,255,255,0.03);color:#dff;padding:10px;border-radius:6px;font-family:monospace}
    .meta{font-size:13px;color:#9aa6b2;margin-bottom:8px}
    .controls{display:flex;gap:8px;margin-top:8px}
    .btn{background:linear-gradient(90deg,#114b3b,#427f62);color:white;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.03);color:#9aa6b2}
    .inbox{background:#08121a;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);font-family:monospace;color:#cfeff0;max-height:200px;overflow:auto}
  </style>
</head>
<body>
  <div class="panel">
    <h1>Communications Console</h1>
    <div class="meta">This page accepts a telemetry snapshot via the query string (?snapshot=...) or via postMessage from the main UI. Use "Send" to simulate transmission.</div>

    <div style="display:flex;gap:12px;align-items:flex-start">
      <div style="flex:1">
        <label style="display:block;margin-bottom:6px;color:#9aa6b2">Prepared message</label>
        <textarea id="messageArea" placeholder="No snapshot received"></textarea>
        <div class="controls">
          <button id="btn-send" class="btn">Send</button>
          <button id="btn-clear" class="btn ghost">Clear</button>
          <a class="btn ghost" href="https://obviouslymelissa-hub.github.io/obsidianbastian/index.html" style="text-decoration:none">Back to Hub</a>
        </div>
      </div>
      <div style="width:320px">
        <div style="margin-bottom:8px;color:#9aa6b2">Latest snapshot (raw)</div>
        <div class="inbox" id="snapshotRaw">No snapshot</div>
      </div>
    </div>

    <div style="margin-top:12px;color:#9aa6b2;font-size:13px">Tips: snapshots sent from the main UI will appear here. This is a local simulation — implement your own transmission backend to actually send messages.</div>
  </div>

<script>
// helper to pretty-print JSON safely
function pretty(json) {
  try { return JSON.stringify(json, null, 2); } catch(e){ return String(json); }
}

const snapshotRawEl = document.getElementById('snapshotRaw');
const messageArea = document.getElementById('messageArea');

// Try to read snapshot from ?snapshot=<encoded JSON>
function readSnapshotFromQuery() {
  const params = new URLSearchParams(location.search);
  if (!params.has('snapshot')) return null;
  try {
    const decoded = decodeURIComponent(params.get('snapshot'));
    return JSON.parse(decoded);
  } catch(e) {
    return null;
  }
}

function applySnapshot(snapshot) {
  if (!snapshot) return;
  snapshotRawEl.textContent = pretty(snapshot);
  // create a friendly prefilled message (you can customize)
  const ts = snapshot.ts || (new Date()).toISOString();
  let body = `Telemetry snapshot — ${ts}\n\n`;
  if (snapshot.meta && snapshot.meta.event) body += `Event: ${snapshot.meta.event}\n`;
  const tel = snapshot.telemetry || {};
  body += `O2: ${tel.o2 ? tel.o2.toFixed(1)+'%' : 'N/A'}\n`;
  body += `Pressure: ${tel.pressure ? tel.pressure.toFixed(1)+' kPa' : 'N/A'}\n`;
  body += `CO2: ${tel.co2 ? Math.round(tel.co2)+' ppm' : 'N/A'}\n`;
  body += `Temp: ${tel.temp ? tel.temp.toFixed(1)+'°C' : 'N/A'}\n`;
  body += `Humidity: ${tel.humidity ? tel.humidity.toFixed(0)+'%' : 'N/A'}\n\n`;
  if (snapshot.meta && snapshot.meta.message) body += `Message: ${snapshot.meta.message}\n`;
  messageArea.value = body;
}

// on load, check query string
const initial = readSnapshotFromQuery();
if (initial) applySnapshot(initial);

// listen for postMessage snapshots from the main UI
window.addEventListener('message', (ev)=>{
  try {
    // only accept messages from the same origin for safety
    if (ev.origin !== window.location.origin) return;
  } catch(e){}
  const data = ev.data;
  if (!data) return;
  if (data.type === 'snapshot' && data.payload) {
    applySnapshot(data.payload);
    // reflect raw payload as well
    snapshotRawEl.textContent = pretty(data.payload);
  }
});

// send and clear controls (simulated)
document.getElementById('btn-send').addEventListener('click', ()=>{
  const msg = messageArea.value.trim();
  if (!msg) { alert('No message to send'); return; }
  // Simulate a send; in a real implementation you'd POST to your backend or use websockets
  console.log('Simulated send:', msg);
  alert('Message simulated as sent — check logs.');
});
document.getElementById('btn-clear').addEventListener('click', ()=>{
  messageArea.value = '';
  snapshotRawEl.textContent = 'No snapshot';
});
</script>
</body>
</html>
