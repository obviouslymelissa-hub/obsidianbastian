<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mainframe Weather — Planetary Atmospherics</title>
  <style>
    :root{
      --bg:#0b0f1a; --card:#0f1724; --muted:#9aa6c0; --accent:#6ee7b7;
      --danger:#ff7b7b; --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#041024 0%, #071025 60%);color:#e6eef8;}
    .wrap{max-width:980px;margin:36px auto;padding:24px;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:#042023;border:0;padding:8px 12px;border-radius:8px;font-weight:600;cursor:pointer}
    .toggle{display:flex;align-items:center;gap:8px;font-size:14px}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:16px;margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .item{padding:10px;background:var(--glass);border-radius:8px}
    .label{font-size:12px;color:var(--muted);margin-bottom:6px}
    .big{font-size:18px;font-weight:700}
    .composition{margin-top:10px;display:flex;flex-direction:column;gap:6px}
    .comp-row{display:flex;justify-content:space-between;font-size:13px}
    .bar{height:10px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden;margin-top:6px}
    .bar > i{display:block;height:100%;background:linear-gradient(90deg,#6ee7b7,#60a5fa);width:0%}
    .rightcol{display:flex;flex-direction:column;gap:12px}
    .json{white-space:pre-wrap;background:#041427;padding:12px;border-radius:8px;color:#bfe6ff;font-size:13px;max-height:420px;overflow:auto}
    .footer{margin-top:18px;color:var(--muted);font-size:13px}
    .pill{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);font-weight:600}
    .good{color:var(--accent);font-weight:700}
    .bad{color:var(--danger);font-weight:700}
    .small{font-size:12px;color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Mainframe Weather — Planetary Atmospherics</h1>
        <div class="small">Random solar system and planet generator with atmospheric conditions and habitability check.</div>
      </div>
      <div class="controls">
        <div class="toggle">
          <label><input id="earthToggle" type="checkbox"> Local Earth Conditions</label>
        </div>
        <button id="shuffle">Randomize</button>
        <button id="copyJson">Copy JSON</button>
      </div>
    </header>

    <div class="grid">
      <div>
        <div class="card">
          <div class="row" style="justify-content:space-between;align-items:flex-start">
            <div>
              <div class="label">System</div>
              <div class="big" id="systemName">—</div>
              <div class="small" id="starInfo">Star: —</div>
            </div>
            <div style="text-align:right">
              <div class="label">Planet</div>
              <div class="big" id="planetName">—</div>
              <div class="small" id="planetSummary">—</div>
            </div>
          </div>

          <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

          <div class="stats">
            <div class="item">
              <div class="label">Orbital Radius</div>
              <div id="orbital" class="big">—</div>
            </div>
            <div class="item">
              <div class="label">Surface Gravity</div>
              <div id="gravity" class="big">—</div>
            </div>
            <div class="item">
              <div class="label">Mean Temperature</div>
              <div id="temperature" class="big">—</div>
            </div>
            <div class="item">
              <div class="label">Surface Pressure</div>
              <div id="pressure" class="big">—</div>
            </div>
            <div class="item">
              <div class="label">Wind (peak)</div>
              <div id="wind" class="big">—</div>
            </div>
            <div class="item">
              <div class="label">Cloud Coverage</div>
              <div id="clouds" class="big">—</div>
            </div>
          </div>

          <div style="margin-top:12px">
            <div class="label">Atmospheric Composition</div>
            <div id="composition" class="composition"></div>
          </div>

          <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
            <div class="pill" id="habitabilityPill">—</div>
            <div class="small" id="habitabilityReason">—</div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="label">Notable Weather & Phenomena</div>
          <div id="phenomena" class="small" style="margin-top:8px">—</div>
        </div>
      </div>

      <aside class="rightcol">
        <div class="card">
          <div class="label">System Location</div>
          <div id="location" style="margin-top:8px" class="small">—</div>
          <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">
          <div class="label">Diagnostics</div>
          <div class="small" id="diagnostics" style="margin-top:8px">—</div>
        </div>

        <div class="card">
          <div class="label">Raw Data (JSON)</div>
          <div id="json" class="json">—</div>
        </div>
      </aside>
    </div>

    <div class="footer">
      Tip: toggle "Local Earth Conditions" to inspect a stable, livable report for comparison.
    </div>
  </div>

<script type="module">
import { generateDataset, setEarth } from './atmos.js';

(function(){
  // Utility
  const qs = s => document.querySelector(s);

  // DOM
  const el = {
    systemName: qs('#systemName'),
    starInfo: qs('#starInfo'),
    planetName: qs('#planetName'),
    planetSummary: qs('#planetSummary'),
    orbital: qs('#orbital'),
    gravity: qs('#gravity'),
    temperature: qs('#temperature'),
    pressure: qs('#pressure'),
    wind: qs('#wind'),
    clouds: qs('#clouds'),
    composition: qs('#composition'),
    habitabilityPill: qs('#habitabilityPill'),
    habitabilityReason: qs('#habitabilityReason'),
    phenomena: qs('#phenomena'),
    location: qs('#location'),
    diagnostics: qs('#diagnostics'),
    json: qs('#json'),
    shuffle: qs('#shuffle'),
    earthToggle: qs('#earthToggle'),
    copyJson: qs('#copyJson'),
  };

  function render(dataset){
    const star = dataset.star;
    const planet = dataset.planet;
    el.systemName.textContent = planet.systemName || star.name || '—';
    el.starInfo.textContent = `${star.name} • ${star.type || '='}`;
    el.planetName.textContent = planet.planetCode;
    el.planetSummary.textContent = `${planet.type} • ${planet.radiusEarth} R⊕ • ${planet.massEarth} M⊕`;
    el.orbital.textContent = `${planet.orbitalAU} AU (index ${planet.index})`;
    el.gravity.textContent = `${planet.gravity} g`;
    el.temperature.textContent = `${planet.tempC} °C`;
    el.pressure.textContent = `${planet.pressureBar} bar`;
    el.wind.textContent = `${planet.windKph} km/h`;
    el.clouds.textContent = `${planet.cloudsPercent} %`;

    // Composition UI
    el.composition.innerHTML = '';
    planet.composition.slice(0,8).forEach(comp=>{
      const row = document.createElement('div');
      row.className = 'comp-row';
      row.innerHTML = `<div>${comp.gas}</div><div>${comp.pct}%</div>`;
      const barWrap = document.createElement('div');
      barWrap.className = 'bar';
      const bar = document.createElement('i');
      bar.style.width = Math.max(2, Math.min(100, comp.pct)) + '%';
      barWrap.appendChild(bar);
      el.composition.appendChild(row);
      el.composition.appendChild(barWrap);
    });

    // Habitability
    el.habitabilityPill.textContent = planet.habitability.habitable ? 'LIVABLE' : 'UNSUITABLE';
    el.habitabilityPill.className = 'pill ' + (planet.habitability.habitable ? 'good' : 'bad');
    el.habitabilityReason.textContent = (planet.habitability.habitable ? planet.habitability.reasons.join(' ') : planet.habitability.reasons.slice(0,3).join(' '));

    el.phenomena.textContent = planet.phenomena.join('; ');
    el.location.textContent = `≈ Sector ${makeCoordinate()} • System ${planet.systemName} • Star class ${star.cls || ''}${star.sub || ''}${star.lum || ''}`;
    const seedInfo = dataset.meta && dataset.meta.seedText ? `Seed: ${dataset.meta.seedText}` : 'Seedless';
    el.diagnostics.textContent = `Generated ${new Date().toISOString()} • ${seedInfo}`;

    const pretty = JSON.stringify({star,planet}, null, 2);
    el.json.textContent = pretty;
  }

  function makeCoordinate(){
    const randint = (min,max) => Math.floor(Math.random()*(max-min+1))+min;
    const x = randint(-1200,1200);
    const y = randint(-1200,1200);
    const z = randint(-1200,1200);
    return `${x}, ${y}, ${z}`;
  }

  // Utils for URL params
  function params(){
    const search = new URLSearchParams(location.search);
    const o = {};
    for(const [k,v] of search.entries()) o[k]=v;
    return o;
  }

  async function randomize(seedParam){
    if(el.earthToggle.checked){
      const ds = setEarth();
      render(ds);
      return;
    }
    // If seedParam provided, use it
    let ds;
    if(seedParam !== undefined){
      ds = generateDataset({ seed: seedParam });
    } else {
      // Check URL param first
      const p = params();
      if(p.seed) ds = generateDataset({ seed: p.seed });
      else ds = generateDataset();
    }
    render(ds);
  }

  // Copy JSON
  el.copyJson.addEventListener('click', ()=>{
    navigator.clipboard?.writeText(el.json.textContent || '')
      .then(()=> alert('JSON copied to clipboard'))
      .catch(()=> alert('Unable to copy'));
  });

  el.shuffle.addEventListener('click', ()=> randomize());
  el.earthToggle.addEventListener('change', ()=> randomize());

  // Initial: respect ?seed= in URL
  const p = params();
  randomize(p.seed);

})();
</script>
</body>
</html>